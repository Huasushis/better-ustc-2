# Better-USTC-2 项目设计报告

**项目名称**：Better-USTC-2 — 中国科学技术大学"第二课堂"移动端优化应用

**团队成员**：陈鑫、范祎博涵、周映诚

**完成日期**：2025年12月

---

## 目录

1. [项目概述](#1-项目概述)
2. [系统设计](#2-系统设计)
3. [系统测试与运行结果](#3-系统测试与运行结果)
4. [总结与反思](#4-总结与反思)
5. [参考文献](#5-参考文献)
6. [分工说明](#6-分工说明)
7. [生成式AI使用说明](#7-生成式ai使用说明)

---

## 1. 项目概述

### 1.1 项目背景与特点

中国科学技术大学的"第二课堂"平台（简称"二课"）是学校为学生提供课外活动、社会实践、志愿服务等综合素质拓展的重要平台。然而，现有的官方网页端存在以下痛点：

- **移动端体验差**：网页端未针对移动设备优化，操作繁琐
- **信息检索困难**：活动数量众多，缺乏个性化推荐机制
- **报名流程复杂**：需要多步操作才能完成活动报名
- **缺乏提醒功能**：容易错过感兴趣活动的报名截止时间

Better-USTC-2 项目旨在通过构建一个原生移动应用，解决上述问题，为科大学子提供更便捷、智能的二课使用体验。

### 1.2 需求分析

#### 1.2.1 工具解决的问题

| 问题类别 | 具体问题 | 解决方案 |
|---------|---------|---------|
| 用户体验 | 网页端移动适配差 | 开发原生Android应用 |
| 信息过载 | 活动数量多，难以筛选 | 实现智能推荐算法 |
| 操作繁琐 | 登录、报名流程复杂 | 一键登录、快速报名 |
| 信息遗漏 | 错过报名时间 | 活动提醒功能 |

#### 1.2.2 目标用户

- **主要用户**：中国科学技术大学在校本科生、研究生
- **用户特征**：
  - 需要完成二课学时要求
  - 希望参与感兴趣的课外活动
  - 日常使用手机管理学习生活
  - 对活动信息获取效率有较高要求

#### 1.2.3 功能列表

**核心功能**：

| 功能模块 | 功能描述 | 实现状态 |
|---------|---------|---------|
| 统一身份认证 | 使用学校CAS系统登录，支持凭据加密存储 | ✅ 已实现 |
| 活动浏览 | 查看未结束、已报名、已参与活动列表 | ✅ 已实现 |
| 活动详情 | 查看活动详细信息（时间、地点、学时等） | ✅ 已实现 |
| 快速报名 | 一键报名活动，支持自动处理时间冲突 | ✅ 已实现 |
| 取消报名 | 取消已报名的活动 | ✅ 已实现 |
| 智能推荐 | 基于历史参与记录的个性化推荐 | ✅ 已实现 |
| 系列活动 | 支持查看和报名系列课子活动 | ✅ 已实现 |
| 活动筛选 | 按模块、部门、时间、关键词筛选 | ✅ 已实现 |

**辅助功能**：

| 功能模块 | 功能描述 | 实现状态 |
|---------|---------|---------|
| 活动提醒 | 已报名活动开始前20分钟提醒 | ✅ 已实现 |
| 开发者模式 | 查看应用日志，便于调试 | ✅ 已实现 |
| 名额监控 | 自动监控满额活动，有空位时自动报名 | ✅ 已实现 |

**预留功能**：

| 功能模块 | 功能描述 | 实现状态 |
|---------|---------|---------|
| 课表查询 | 集成课表功能 | ⏳ 预留接口 |
| 学时申诉 | 待申诉项目管理 | ⏳ 预留接口 |

#### 1.2.4 性能分析

| 性能指标 | 目标值 | 实际表现 |
|---------|-------|---------|
| 应用启动时间 | < 3秒 | ~2秒（Tauri冷启动） |
| 登录响应时间 | < 5秒 | ~3-4秒（含CAS认证） |
| 活动列表加载 | < 3秒 | ~1-2秒 |
| 报名操作响应 | < 2秒 | ~1秒 |
| APK包体积 | < 50MB | ~30MB |
| 内存占用 | < 200MB | ~100MB |

---

## 2. 系统设计

### 2.1 总体架构

Better-USTC-2 采用 **Tauri v2** 框架，实现前后端分离的混合应用架构：

```
┌─────────────────────────────────────────────────────────────┐
│                      Android 系统层                          │
├─────────────────────────────────────────────────────────────┤
│                     Tauri Runtime                           │
├──────────────────────┬──────────────────────────────────────┤
│    前端 (WebView)     │           后端 (Rust)                │
│  ┌─────────────────┐ │  ┌─────────────────────────────────┐ │
│  │   Vue 3 + Vant  │ │  │         lib.rs (Commands)       │ │
│  │   ┌─────────┐   │ │  │  ┌─────┬─────┬─────┬─────────┐  │ │
│  │   │  Views  │   │◄─┤  │  │auth │state│rec- │security│  │ │
│  │   ├─────────┤   │ │  │  │     │     │ommd │        │  │ │
│  │   │ Stores  │   │─►│  │  └──┬──┴──┬──┴──┬──┴────┬────┘  │ │
│  │   │ (Pinia) │   │ │  │     │     │     │       │       │ │
│  │   ├─────────┤   │ │  │  ┌──▼─────▼─────▼───────▼────┐  │ │
│  │   │Components│   │ │  │  │      rustustc 模块       │  │ │
│  │   └─────────┘   │ │  │  │  ┌─────────┬──────────┐  │  │ │
│  └─────────────────┘ │  │  │  │   CAS   │  Young   │  │  │ │
│                      │  │  │  │ Client  │ Service  │  │  │ │
│                      │  │  │  └────┬────┴────┬─────┘  │  │ │
│                      │  │  └───────┼─────────┼────────┘  │ │
│                      │  └──────────┼─────────┼───────────┘ │
└──────────────────────┴─────────────┼─────────┼─────────────┘
                                     ▼         ▼
                              ┌──────────┐ ┌──────────┐
                              │ CAS服务器 │ │ 二课服务器│
                              │ passport │ │  young   │
                              └──────────┘ └──────────┘
```

### 2.2 模块划分

#### 2.2.1 前端模块

```
src/
├── views/                    # 页面组件
│   ├── HomeView.vue         # 首页（活动列表、筛选、推荐）
│   ├── ActivityDetailView.vue # 活动详情页
│   ├── RegisteredView.vue   # 我的报名
│   ├── ProfileView.vue      # 个人中心
│   ├── LogView.vue          # 开发者日志
│   └── AboutView.vue        # 关于页面
├── components/               # 可复用组件
│   └── ActivityCard.vue     # 活动卡片组件
├── stores/                   # 状态管理 (Pinia)
│   ├── activity.ts          # 活动数据与操作
│   ├── user.ts              # 用户认证与信息
│   └── logs.ts              # 日志记录
├── router/                   # 路由配置
│   └── index.ts
├── App.vue                   # 根组件（含底部导航）
└── main.ts                   # 入口文件
```

#### 2.2.2 后端模块

```
src-tauri/src/
├── lib.rs          # Tauri Commands 入口（暴露给前端的API）
├── auth.rs         # 认证模块（登录、凭据管理、自动登录）
├── state.rs        # 全局状态（CASClient、YouthService实例）
├── security.rs     # 安全模块（AES-GCM加解密）
├── recommend.rs    # 推荐算法模块
└── rustustc/       # 核心业务逻辑
    ├── cas/        # CAS统一身份认证
    │   ├── client.rs   # HTTP客户端、登录逻辑
    │   └── info.rs     # 用户信息获取
    └── young/      # 二课API封装
        ├── service.rs  # YouthService（请求、加密、分页）
        └── model.rs    # 数据模型（活动、筛选器等）
```

### 2.3 关键算法

#### 2.3.1 个性化推荐算法

推荐系统基于用户历史参与活动，使用多维度特征进行评分：

```rust
// 推荐算法核心流程
pub async fn recommend(service: &YouthService, limit: usize) -> Result<Vec<SecondClass>> {
    // 1. 获取用户历史参与活动
    let history = SecondClass::get_participated(service).await?;
    
    // 2. 获取候选活动列表
    let candidates = SecondClass::find(service, SCFilter::new(), false, false, -1).await?;
    
    // 3. 构建用户画像（词频向量）
    let user_vocab = build_user_profile(&history);
    
    // 4. 对每个候选活动评分
    let scored = candidates.iter().map(|item| {
        let mut score = 0.0;
        
        // 4.1 文本相似度（余弦相似度，权重5.0）
        score += cosine_similarity(user_vocab, extract_tokens(item)) * 5.0;
        
        // 4.2 部门匹配度（权重0.5，最高4.0）
        score += department_match_score(item, &history) * 0.5;
        
        // 4.3 模块匹配度（权重0.2，最高2.0）
        score += module_match_score(item, &history) * 0.2;
        
        (score, item)
    });
    
    // 5. 排序并返回Top-K
    scored.sort_by_score().take(limit).collect()
}
```

**文本特征提取**：使用 `jieba-rs` 进行中文分词，提取活动名称、部门、简介等文本特征。

**评分维度**：

| 维度 | 权重 | 说明 |
|-----|------|-----|
| 文本相似度 | 5.0 | 基于TF向量的余弦相似度 |
| 部门匹配 | 0.5×count (max 4.0) | 历史参与同部门活动次数 |
| 模块匹配 | 0.2×count (max 2.0) | 历史参与同模块活动次数 |

#### 2.3.2 凭据安全存储

采用 AES-256-GCM 加密算法保护用户密码：

```rust
pub fn encrypt_data(app: &AppHandle, plaintext: &str) -> Result<String> {
    // 1. 基于机器唯一标识生成密钥
    let machine_id = app.machine_uid();
    let key = SHA256(machine_id + SALT);  // 32字节密钥
    
    // 2. 生成随机Nonce（12字节）
    let nonce = random_bytes(12);
    
    // 3. AES-256-GCM加密
    let cipher = Aes256Gcm::new(&key);
    let ciphertext = cipher.encrypt(&nonce, plaintext)?;
    
    // 4. 返回格式: hex(nonce):hex(ciphertext)
    Ok(format!("{}:{}", hex(nonce), hex(ciphertext)))
}
```

**安全特性**：
- 密钥绑定设备：使用 `machine_uid` 派生密钥，密文在其他设备无法解密
- 抗重放攻击：每次加密使用随机Nonce
- 认证加密：GCM模式提供完整性校验

#### 2.3.3 CAS登录流程

```
用户 ──► 前端 ──invoke──► 后端auth.rs ──► CASClient
                              │
      ◄─── 用户信息 ◄────────┤
                              ▼
                    1. GET /login 获取加密参数
                              │
                    2. AES-ECB加密密码
                              │
                    3. POST /login 提交认证
                              │
                    4. 获取CAS Cookie
                              │
                    5. SSO跳转至二课系统
                              │
                    6. 获取二课Token
                              ▼
                    返回登录成功 + 用户信息
```

### 2.4 界面设计

应用采用移动端优先的设计理念，使用 Vant 组件库实现 Material Design 风格：

#### 2.4.1 页面结构

| 页面 | 功能 | 主要组件 |
|-----|------|---------|
| 首页 | 活动列表、筛选、推荐 | NavBar, Collapse, Search, DropdownMenu |
| 详情页 | 活动信息、报名操作 | NavBar, Cell, Tag, Button |
| 已报页 | 已报名/已参与活动 | Tabs, Tab, ActivityCard |
| 个人中心 | 登录、设置 | Form, Field, Button, Cell |

#### 2.4.2 交互设计

- **底部导航栏**：固定底部，包含"首页"、"已报"、"我的"三个入口
- **安全区域适配**：自动适配刘海屏、底部手势条
- **下拉刷新**：首页支持刷新按钮更新数据
- **加载状态**：操作时显示Loading提示，完成后显示成功/失败Toast
- **确认对话框**：取消报名等危险操作需二次确认

### 2.5 开发语言和工具

| 类别 | 技术选型 | 版本 |
|-----|---------|------|
| **前端框架** | Vue 3 (Composition API) | 3.5.x |
| **构建工具** | Vite | 6.x |
| **UI组件库** | Vant | 4.x |
| **状态管理** | Pinia | 2.x |
| **CSS工具** | UnoCSS | 0.65.x |
| **后端语言** | Rust | 1.83+ |
| **跨平台框架** | Tauri | 2.x |
| **包管理器** | pnpm / Cargo | - |
| **版本控制** | Git + GitHub | - |
| **CI/CD** | GitHub Actions | - |

**主要依赖库**：

| 库名 | 用途 |
|-----|------|
| tauri-plugin-http | HTTP请求（支持Cookie） |
| tauri-plugin-store | 本地数据存储 |
| tauri-plugin-notification | 系统通知 |
| tauri-plugin-machine-uid | 设备唯一标识 |
| aes-gcm | AES加密 |
| jieba-rs | 中文分词 |
| chrono | 日期时间处理 |
| serde | 序列化/反序列化 |

---

## 3. 系统测试与运行结果

### 3.1 测试方案

#### 3.1.1 单元测试

针对核心模块编写单元测试：

| 测试模块 | 测试内容 | 测试文件 |
|---------|---------|---------|
| 时间处理 | TimePeriod解析、重叠判断 | model.rs |
| 筛选器 | SCFilter条件匹配 | model.rs |
| 加解密 | AES-GCM正确性 | security.rs |
| 活动状态 | 报名状态判断 | model.rs |

#### 3.1.2 集成测试

需要真实网络环境和测试账号：

```bash
# 设置测试账号
export USTC_CAS_USR="your_student_id"
export USTC_CAS_PWD="your_password"

# 运行集成测试
cargo test -p better_ustc_2_lib -- --ignored
```

测试用例：

| 测试项 | 描述 | 预期结果 |
|-------|------|---------|
| 登录测试 | CAS认证流程 | 成功获取Token |
| 活动获取 | 获取未结束活动列表 | 返回有效活动数组 |
| 报名测试 | 报名指定活动 | 返回成功/已满提示 |
| 推荐测试 | 获取推荐活动 | 返回评分排序的活动列表 |

#### 3.1.3 鲁棒性测试

| 测试场景 | 测试方法 | 预期行为 |
|---------|---------|---------|
| 网络断开 | 关闭网络后操作 | 显示网络错误提示 |
| Token过期 | 等待会话超时 | 自动尝试重新登录 |
| 密码错误 | 输入错误密码 | 提示"用户名或密码错误" |
| 活动已满 | 报名满额活动 | 提示"名额已满" |
| 时间冲突 | 报名冲突时间活动 | 提示冲突并询问是否自动取消 |
| 设备更换 | 在新设备打开应用 | 密码解密失败，需重新登录 |

### 3.2 测试结果

#### 3.2.1 功能测试结果

| 功能点 | 测试结果 | 备注 |
|-------|---------|------|
| 登录 | ✅ 通过 | CAS认证正常 |
| 自动登录 | ✅ 通过 | 凭据加密存储有效 |
| 活动列表 | ✅ 通过 | 数据正确加载 |
| 活动详情 | ✅ 通过 | 信息完整显示 |
| 报名功能 | ✅ 通过 | 状态实时更新 |
| 取消报名 | ✅ 通过 | 状态实时更新 |
| 智能推荐 | ✅ 通过 | 推荐结果合理 |
| 活动筛选 | ✅ 通过 | 多条件筛选正常 |
| 系列活动 | ✅ 通过 | 子活动正确展示 |
| 活动提醒 | ✅ 通过 | 通知正常推送 |

#### 3.2.2 性能测试结果

测试设备：Android 模拟器 (API 34)

| 指标 | 测试结果 |
|-----|---------|
| 冷启动时间 | 2.1秒 |
| 热启动时间 | 0.8秒 |
| 登录耗时 | 3.5秒 |
| 列表加载 | 1.2秒 |
| 内存占用 | 95MB |
| APK大小 | 28MB |

### 3.3 运行界面截图

> 注：以下为应用主要界面的示意描述

#### 3.3.1 登录界面
- 顶部：应用Logo和名称
- 中部：学号输入框、密码输入框
- 底部：登录按钮、保存密码选项

#### 3.3.2 首页
- 顶部导航栏：标题"首页"、刷新按钮
- 筛选区：模块标签、部门选择、时间筛选、关键词搜索
- 活动列表：
  - 推荐活动折叠面板
  - 全部活动折叠面板
  - 每个活动显示：封面图、名称、时间、地点、状态标签
- 底部导航：首页(选中)、已报、我的

#### 3.3.3 活动详情页
- 顶部：返回按钮、标题"活动详情"
- 内容区：
  - 活动封面大图
  - 活动名称、状态标签
  - 详细信息（时间、地点、学时、报名人数等）
  - 活动简介
- 底部操作栏：报名按钮 / 取消报名按钮 / 名额监控按钮

#### 3.3.4 我的报名
- 顶部导航栏：标题"我的报名"
- Tab切换：报名中/已截止 | 已参与/已结项
- 活动卡片列表

#### 3.3.5 个人中心
- 用户信息卡片：头像、姓名、班级
- 功能入口：我的报名、关于、查看日志(开发者模式)
- 登录表单(未登录时显示)
- 状态信息：登录状态、已存储账号、学时统计

---

## 4. 总结与反思

### 4.1 创新点

1. **跨平台技术选型**：采用 Tauri v2 框架，相比 Electron 显著减小包体积（约1/3），同时利用 Rust 后端保证性能和安全性。

2. **本地化推荐算法**：推荐计算完全在客户端完成，无需服务器支持，保护用户隐私的同时实现个性化推荐。

3. **设备绑定加密**：凭据使用设备唯一标识派生密钥加密，即使数据库泄露也无法在其他设备解密。

4. **智能冲突处理**：报名时自动检测时间冲突，提供一键取消冲突活动并重新报名的选项。

5. **名额监控功能**：对满额活动提供自动监控，有空位时立即尝试报名。

### 4.2 难点与解决方案

| 难点 | 问题描述 | 解决方案 |
|-----|---------|---------|
| CAS认证 | 学校CAS系统使用AES-ECB加密密码，需逆向分析 | 分析前端JS代码，使用Rust实现相同加密逻辑 |
| 二课API加密 | 二课接口参数需AES-CBC加密 | 抓包分析加密流程，Rust侧实现加解密 |
| 移动端适配 | Tauri v2 移动端文档较少 | 参考官方示例，结合社区讨论解决 |
| 状态同步 | 报名/取消后多页面状态需同步 | 使用Pinia集中管理，实现响应式更新 |
| 中文分词 | 推荐算法需要中文分词 | 集成jieba-rs，支持精确模式分词 |

### 4.3 心得体会

1. **技术选型的重要性**：Tauri v2 虽然相对新颖，但其 Rust 后端带来的性能和安全优势明显，值得投入学习成本。

2. **逆向工程的必要性**：与学校系统对接时，需要分析现有接口的加密方式，这要求一定的逆向分析能力。

3. **用户体验的细节**：移动端应用的用户体验在于细节，如加载状态、错误提示、操作反馈等都需要精心设计。

4. **团队协作的价值**：前后端分离的架构便于团队分工，但也需要良好的接口文档和沟通。

### 4.4 不足与改进方向

| 不足 | 改进方向 |
|-----|---------|
| 推荐算法简单 | 引入协同过滤或深度学习模型 |
| 离线功能缺失 | 添加数据缓存，支持离线浏览 |
| 仅支持Android | 扩展iOS支持 |
| 课表功能未实现 | 对接教务系统，实现课表查询 |
| 错误处理不统一 | 重构为统一的错误类型体系 |
| 测试覆盖率不足 | 增加单元测试和E2E测试 |

---

## 5. 参考文献

### 5.1 框架与工具文档

1. Tauri 官方文档. https://v2.tauri.app/
2. Vue 3 官方文档. https://vuejs.org/
3. Vant 4 组件库文档. https://vant-ui.github.io/vant/
4. Pinia 状态管理文档. https://pinia.vuejs.org/
5. Rust 语言官方文档. https://doc.rust-lang.org/

### 5.2 依赖库文档

6. jieba-rs 中文分词. https://github.com/messense/jieba-rs
7. aes-gcm 加密库. https://docs.rs/aes-gcm/
8. reqwest HTTP客户端. https://docs.rs/reqwest/
9. serde 序列化框架. https://serde.rs/

### 5.3 学习资源

10. Tauri v2 移动端开发指南. https://v2.tauri.app/start/prerequisites/
11. Android NDK 配置文档. https://developer.android.com/ndk
12. GitHub Actions 文档. https://docs.github.com/en/actions

### 5.4 相关项目

13. 中国科学技术大学第二课堂平台. https://young.ustc.edu.cn/
14. 中国科学技术大学统一身份认证. https://passport.ustc.edu.cn/

---

## 6. 分工说明

| 成员 | 主要职责 | 具体工作 |
|-----|---------|---------|
| **陈鑫** | 推荐算法、后端开发 | 1. 设计并实现个性化推荐算法<br>2. 实现CAS认证模块<br>3. 实现二课API封装<br>4. 实现凭据加密存储<br>5. 后端架构设计 |
| **范祎博涵** | 测试 | 1. 编写测试用例<br>2. 执行功能测试<br>3. 执行性能测试<br>4. 执行鲁棒性测试<br>5. Bug反馈与验证 |
| **周映诚** | 前端测试调试 | 1. 前端页面开发与调试<br>2. UI/UX优化<br>3. 前后端联调<br>4. 前端Bug修复<br>5. 移动端适配调试 |

---

## 7. 生成式AI使用说明

本项目在开发过程中使用了生成式AI工具辅助开发，具体说明如下：

### 7.1 使用的AI工具

- **GitHub Copilot** (Claude Opus 4.5)

### 7.2 AI辅助的代码部分

| 模块/文件 | AI辅助内容 | 人工修改 |
|----------|-----------|---------|
| `src/views/*.vue` | 页面组件框架生成、Vue 3 Composition API 代码 | 业务逻辑调整、样式优化 |
| `src/stores/*.ts` | Pinia store 结构生成 | 接口对接、错误处理 |
| `src/components/ActivityCard.vue` | 组件模板生成 | 样式调整、事件处理 |
| `src-tauri/src/lib.rs` | Tauri command 框架 | 业务逻辑实现 |
| `src-tauri/src/security.rs` | 加密函数框架 | 安全性审查与调整 |
| `docs/*.md` | 文档结构与内容 | 技术细节补充 |

### 7.3 AI使用原则

1. **代码审查**：所有AI生成的代码经过人工审查后才合并
2. **安全敏感代码**：加密、认证等安全相关代码经过额外审查
3. **业务逻辑**：核心业务逻辑由人工设计，AI仅辅助实现
4. **文档生成**：AI辅助生成文档框架，技术细节由团队成员补充

### 7.4 AI使用声明

本项目的核心架构设计、算法设计、安全方案均由团队成员独立完成。AI工具主要用于：
- 加速重复性代码编写
- 辅助调试和问题排查
- 生成文档框架
- 代码风格优化建议

所有AI生成内容均经过人工验证，确保正确性和安全性。

---

**报告完成日期**：2025年12月18日

**项目仓库**：https://github.com/huasushis/better-ustc-2
